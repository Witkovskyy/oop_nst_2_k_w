\doxysection{TT.\+h}
\hypertarget{_t_t_8h_source}{}\label{_t_t_8h_source}\index{src/engine/tables/TT.h@{src/engine/tables/TT.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ "{}../moves.h"{}}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00009\ \textcolor{keyword}{enum}\ TTFlag\ \{}
\DoxyCodeLine{00010\ \ \ \ \ TT\_EXACT,\ \ \ \textcolor{comment}{//\ Exact}}
\DoxyCodeLine{00011\ \ \ \ \ TT\_ALPHA,\ \ \ \textcolor{comment}{//\ Upper\ Bound\ }}
\DoxyCodeLine{00012\ \ \ \ \ TT\_BETA\ \ \ \ \ \textcolor{comment}{//\ Lower\ Bound\ }}
\DoxyCodeLine{00013\ \};}
\DoxyCodeLine{00018\ \textcolor{keyword}{struct\ }\doxymbox{\hyperlink{struct_t_t_entry}{TTEntry}}\ \{}
\DoxyCodeLine{00019\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ key;\ \textcolor{comment}{//\ Collision}}
\DoxyCodeLine{00020\ \ \ \ \ \textcolor{keywordtype}{int}\ score;}
\DoxyCodeLine{00021\ \ \ \ \ \textcolor{keywordtype}{int}\ depth;}
\DoxyCodeLine{00022\ \ \ \ \ TTFlag\ flag;}
\DoxyCodeLine{00023\ \ \ \ \ \doxymbox{\hyperlink{struct_move}{Move}}\ bestMove;\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00024\ \};}
\DoxyCodeLine{00029\ \textcolor{keyword}{class\ }\doxymbox{\hyperlink{class_transposition_table_a724d9f922515719e2b44ffbb8a6b7ffc}{TranspositionTable}}\ \{}
\DoxyCodeLine{00030\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00035\ \ \ \ \ std::vector<TTEntry>\ \doxymbox{\hyperlink{class_transposition_table_a98da28427b6c0c7fa244badca4f78d05}{table}};}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keywordtype}{int}\ \doxymbox{\hyperlink{class_transposition_table_af10660e185d05d66c19275a07fd7e7db}{size}};}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00049\ \ \ \ \ \doxymbox{\hyperlink{class_transposition_table_a724d9f922515719e2b44ffbb8a6b7ffc}{TranspositionTable}}(\textcolor{keywordtype}{int}\ sizeInMB)\ \{}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ How\ many\ entries\ fit\ in\ the\ given\ size}}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ entrySize\ =\ \textcolor{keyword}{sizeof}(\doxymbox{\hyperlink{struct_t_t_entry}{TTEntry}});}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ numEntries\ =\ (sizeInMB\ *\ 1024\ *\ 1024)\ /\ entrySize;}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \doxymbox{\hyperlink{class_transposition_table_a98da28427b6c0c7fa244badca4f78d05}{table}}.resize(numEntries);}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \doxymbox{\hyperlink{class_transposition_table_af10660e185d05d66c19275a07fd7e7db}{size}}\ =\ numEntries;}
\DoxyCodeLine{00055\ \ \ \ \ \}}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{class_transposition_table_a1e8ae72c80b51976356a6a7943b05b0a}{clear}}()\ \{}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ std::fill(\doxymbox{\hyperlink{class_transposition_table_a98da28427b6c0c7fa244badca4f78d05}{table}}.begin(),\ \doxymbox{\hyperlink{class_transposition_table_a98da28427b6c0c7fa244badca4f78d05}{table}}.end(),\ \doxymbox{\hyperlink{struct_t_t_entry}{TTEntry}}\{\ 0,\ 0,\ 0,\ TT\_EXACT,\ Move()\ \});}
\DoxyCodeLine{00064\ \ \ \ \ \}}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{comment}{//\ Save\ position}}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{class_transposition_table_a1712398fea56846c3a7709efc91cc68a}{store}}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ key,\ \textcolor{keywordtype}{int}\ score,\ \textcolor{keywordtype}{int}\ depth,\ TTFlag\ flag,\ \doxymbox{\hyperlink{struct_move}{Move}}\ bestMove)\ \{}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ index\ =\ key\ \%\ \doxymbox{\hyperlink{class_transposition_table_af10660e185d05d66c19275a07fd7e7db}{size}};}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Always\ preserve\ the\ entry\ with\ the\ greatest\ depth}}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Always\ overwrite\ for\ simplicity}}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \doxymbox{\hyperlink{struct_t_t_entry}{TTEntry}}\&\ entry\ =\ \doxymbox{\hyperlink{class_transposition_table_a98da28427b6c0c7fa244badca4f78d05}{table}}[index];}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (entry.key\ ==\ key)\ \{}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (depth\ >=\ entry.depth)\ \{}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ entry.score\ =\ score;}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ entry.depth\ =\ depth;}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ entry.flag\ =\ flag;}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ entry.bestMove\ =\ bestMove;}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Always\ overwrite}}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \ \ \ \ entry.key\ =\ key;}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \ \ \ \ entry.score\ =\ score;}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \ \ \ \ entry.depth\ =\ depth;}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \ \ \ \ entry.flag\ =\ flag;}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \ \ \ \ entry.bestMove\ =\ bestMove;}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00100\ \ \ \ \ \}}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{comment}{//\ Read\ position}}
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{keywordtype}{bool}\ \doxymbox{\hyperlink{class_transposition_table_a282290f874e3ddc1afb67edcfb1d7b4a}{probe}}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ key,\ \textcolor{keywordtype}{int}\ depth,\ \textcolor{keywordtype}{int}\ alpha,\ \textcolor{keywordtype}{int}\ beta,\ \textcolor{keywordtype}{int}\&\ outScore,\ \doxymbox{\hyperlink{struct_move}{Move}}\&\ outMove)\ \{}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (key\ ==\ 0)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ index\ =\ key\ \%\ \doxymbox{\hyperlink{class_transposition_table_af10660e185d05d66c19275a07fd7e7db}{size}};}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \doxymbox{\hyperlink{struct_t_t_entry}{TTEntry}}\&\ entry\ =\ \doxymbox{\hyperlink{class_transposition_table_a98da28427b6c0c7fa244badca4f78d05}{table}}[index];}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (entry.key\ ==\ 0)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (entry.key\ ==\ key)\ \{\ \textcolor{comment}{//\ Hit}}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \ \ \ outMove\ =\ entry.bestMove;\ \textcolor{comment}{//\ Always\ return\ best\ move}}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (entry.depth\ >=\ depth)\ \{\ \textcolor{comment}{//\ Only\ if\ reached\ depth}}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (entry.flag\ ==\ TT\_EXACT)\ \{}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ outScore\ =\ entry.score;}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (entry.flag\ ==\ TT\_ALPHA\ \&\&\ entry.score\ <=\ alpha)\ \{}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ outScore\ =\ alpha;}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (entry.flag\ ==\ TT\_BETA\ \&\&\ entry.score\ >=\ beta)\ \{}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ outScore\ =\ beta;}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00140\ \ \ \ \ \}}
\DoxyCodeLine{00141\ \};}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \textcolor{comment}{//\ 64\ MB\ Transposition\ Table\ instance}}
\DoxyCodeLine{00148\ \textcolor{keyword}{extern}\ \doxymbox{\hyperlink{class_transposition_table}{TranspositionTable}}\ TT;}

\end{DoxyCode}
