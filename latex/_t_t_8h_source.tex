\doxysection{TT.\+h}
\hypertarget{_t_t_8h_source}{}\label{_t_t_8h_source}\index{src/engine/tables/TT.h@{src/engine/tables/TT.h}}
\doxymbox{\hyperlink{_t_t_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}\doxymbox{\hyperlink{moves_8h}{../moves.h}}"{}}}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00018\ \textcolor{keyword}{enum}\ \doxymbox{\hyperlink{_t_t_8h_a2add7e9edf4c9305f372b0e50897ce99}{TTFlag}}\ \{}
\DoxyCodeLine{00019\ \ \ \ \ TT\_EXACT,\ \ \ \textcolor{comment}{//\ Exact}}
\DoxyCodeLine{00020\ \ \ \ \ TT\_ALPHA,\ \ \ \textcolor{comment}{//\ Upper\ Bound\ }}
\DoxyCodeLine{00021\ \ \ \ \ TT\_BETA\ \ \ \ \ \textcolor{comment}{//\ Lower\ Bound\ }}
\DoxyCodeLine{00022\ \};}
\DoxyCodeLine{00027\ \textcolor{keyword}{struct\ }\doxymbox{\hyperlink{struct_t_t_entry}{TTEntry}}\ \{}
\DoxyCodeLine{00028\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ key;\ \textcolor{comment}{//\ Collision}}
\DoxyCodeLine{00029\ \ \ \ \ \textcolor{keywordtype}{int}\ score;}
\DoxyCodeLine{00030\ \ \ \ \ \textcolor{keywordtype}{int}\ depth;}
\DoxyCodeLine{00031\ \ \ \ \ \doxymbox{\hyperlink{_t_t_8h_a2add7e9edf4c9305f372b0e50897ce99}{TTFlag}}\ flag;}
\DoxyCodeLine{00032\ \ \ \ \ \doxymbox{\hyperlink{struct_move}{Move}}\ bestMove;\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00033\ \};}
\DoxyCodeLine{00038\ \textcolor{keyword}{class\ }\doxymbox{\hyperlink{class_transposition_table_a724d9f922515719e2b44ffbb8a6b7ffc}{TranspositionTable}}\ \{}
\DoxyCodeLine{00039\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00044\ \ \ \ \ std::vector<TTEntry>\ \doxymbox{\hyperlink{class_transposition_table_a98da28427b6c0c7fa244badca4f78d05}{table}};}
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{keywordtype}{int}\ \doxymbox{\hyperlink{class_transposition_table_af10660e185d05d66c19275a07fd7e7db}{size}};}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00058\ \ \ \ \ \doxymbox{\hyperlink{class_transposition_table_a724d9f922515719e2b44ffbb8a6b7ffc}{TranspositionTable}}(\textcolor{keywordtype}{int}\ sizeInMB)\ \{}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ How\ many\ entries\ fit\ in\ the\ given\ size}}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ entrySize\ =\ \textcolor{keyword}{sizeof}(\doxymbox{\hyperlink{struct_t_t_entry}{TTEntry}});}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ numEntries\ =\ (sizeInMB\ *\ 1024\ *\ 1024)\ /\ entrySize;}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \doxymbox{\hyperlink{class_transposition_table_a98da28427b6c0c7fa244badca4f78d05}{table}}.resize(numEntries);}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \doxymbox{\hyperlink{class_transposition_table_af10660e185d05d66c19275a07fd7e7db}{size}}\ =\ numEntries;}
\DoxyCodeLine{00064\ \ \ \ \ \}}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{class_transposition_table_a1e8ae72c80b51976356a6a7943b05b0a}{clear}}()\ \{}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ std::fill(\doxymbox{\hyperlink{class_transposition_table_a98da28427b6c0c7fa244badca4f78d05}{table}}.begin(),\ \doxymbox{\hyperlink{class_transposition_table_a98da28427b6c0c7fa244badca4f78d05}{table}}.end(),\ \doxymbox{\hyperlink{struct_t_t_entry}{TTEntry}}\{\ 0,\ 0,\ 0,\ TT\_EXACT,\ Move()\ \});}
\DoxyCodeLine{00073\ \ \ \ \ \}}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{comment}{//\ Save\ position}}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{class_transposition_table_a1712398fea56846c3a7709efc91cc68a}{store}}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ key,\ \textcolor{keywordtype}{int}\ score,\ \textcolor{keywordtype}{int}\ depth,\ \doxymbox{\hyperlink{_t_t_8h_a2add7e9edf4c9305f372b0e50897ce99}{TTFlag}}\ flag,\ \doxymbox{\hyperlink{struct_move}{Move}}\ bestMove)\ \{}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ index\ =\ key\ \%\ \doxymbox{\hyperlink{class_transposition_table_af10660e185d05d66c19275a07fd7e7db}{size}};}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Always\ preserve\ the\ entry\ with\ the\ greatest\ depth}}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Always\ overwrite\ for\ simplicity}}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \doxymbox{\hyperlink{struct_t_t_entry}{TTEntry}}\&\ entry\ =\ \doxymbox{\hyperlink{class_transposition_table_a98da28427b6c0c7fa244badca4f78d05}{table}}[index];}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (entry.key\ ==\ key)\ \{}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (depth\ >=\ entry.depth)\ \{}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ entry.score\ =\ score;}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ entry.depth\ =\ depth;}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ entry.flag\ =\ flag;}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ entry.bestMove\ =\ bestMove;}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Always\ overwrite}}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \ \ \ \ entry.key\ =\ key;}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \ \ \ \ entry.score\ =\ score;}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \ \ \ \ entry.depth\ =\ depth;}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ entry.flag\ =\ flag;}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ \ \ entry.bestMove\ =\ bestMove;}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00109\ \ \ \ \ \}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{comment}{//\ Read\ position}}
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{keywordtype}{bool}\ \doxymbox{\hyperlink{class_transposition_table_a282290f874e3ddc1afb67edcfb1d7b4a}{probe}}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ key,\ \textcolor{keywordtype}{int}\ depth,\ \textcolor{keywordtype}{int}\ alpha,\ \textcolor{keywordtype}{int}\ beta,\ \textcolor{keywordtype}{int}\&\ outScore,\ \doxymbox{\hyperlink{struct_move}{Move}}\&\ outMove)\ \{}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (key\ ==\ 0)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ index\ =\ key\ \%\ \doxymbox{\hyperlink{class_transposition_table_af10660e185d05d66c19275a07fd7e7db}{size}};}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \doxymbox{\hyperlink{struct_t_t_entry}{TTEntry}}\&\ entry\ =\ \doxymbox{\hyperlink{class_transposition_table_a98da28427b6c0c7fa244badca4f78d05}{table}}[index];}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (entry.key\ ==\ 0)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (entry.key\ ==\ key)\ \{\ \textcolor{comment}{//\ Hit}}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \ \ \ \ outMove\ =\ entry.bestMove;\ \textcolor{comment}{//\ Always\ return\ best\ move}}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (entry.depth\ >=\ depth)\ \{\ \textcolor{comment}{//\ Only\ if\ reached\ depth}}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (entry.flag\ ==\ TT\_EXACT)\ \{}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ outScore\ =\ entry.score;}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (entry.flag\ ==\ TT\_ALPHA\ \&\&\ entry.score\ <=\ alpha)\ \{}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ outScore\ =\ alpha;}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (entry.flag\ ==\ TT\_BETA\ \&\&\ entry.score\ >=\ beta)\ \{}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ outScore\ =\ beta;}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00149\ \ \ \ \ \}}
\DoxyCodeLine{00150\ \};}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ \textcolor{comment}{//\ 64\ MB\ Transposition\ Table\ instance}}
\DoxyCodeLine{00157\ \textcolor{keyword}{extern}\ \doxymbox{\hyperlink{class_transposition_table}{TranspositionTable}}\ TT;}

\end{DoxyCode}
