\doxysection{TT.\+h}
\hypertarget{_t_t_8h_source}{}\label{_t_t_8h_source}\index{src/engine/tables/TT.h@{src/engine/tables/TT.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ "{}../moves.h"{}}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{keyword}{enum}\ TTFlag\ \{}
\DoxyCodeLine{00006\ \ \ \ \ TT\_EXACT,\ \ \ \textcolor{comment}{//\ Exact}}
\DoxyCodeLine{00007\ \ \ \ \ TT\_ALPHA,\ \ \ \textcolor{comment}{//\ Upper\ Bound\ }}
\DoxyCodeLine{00008\ \ \ \ \ TT\_BETA\ \ \ \ \ \textcolor{comment}{//\ Lower\ Bound\ }}
\DoxyCodeLine{00009\ \};}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{keyword}{struct\ }\doxymbox{\hyperlink{struct_t_t_entry}{TTEntry}}\ \{}
\DoxyCodeLine{00012\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ key;\ \textcolor{comment}{//\ Collision}}
\DoxyCodeLine{00013\ \ \ \ \ \textcolor{keywordtype}{int}\ score;}
\DoxyCodeLine{00014\ \ \ \ \ \textcolor{keywordtype}{int}\ depth;}
\DoxyCodeLine{00015\ \ \ \ \ TTFlag\ flag;}
\DoxyCodeLine{00016\ \ \ \ \ \doxymbox{\hyperlink{struct_move}{Move}}\ bestMove;\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00017\ \};}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{keyword}{class\ }\doxymbox{\hyperlink{class_transposition_table_a724d9f922515719e2b44ffbb8a6b7ffc}{TranspositionTable}}\ \{}
\DoxyCodeLine{00020\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00021\ \ \ \ \ std::vector<TTEntry>\ table;}
\DoxyCodeLine{00022\ \ \ \ \ \textcolor{keywordtype}{int}\ size;}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00031\ \ \ \ \ \doxymbox{\hyperlink{class_transposition_table_a724d9f922515719e2b44ffbb8a6b7ffc}{TranspositionTable}}(\textcolor{keywordtype}{int}\ sizeInMB)\ \{}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ How\ many\ entries\ fit\ in\ the\ given\ size}}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ entrySize\ =\ \textcolor{keyword}{sizeof}(\doxymbox{\hyperlink{struct_t_t_entry}{TTEntry}});}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ numEntries\ =\ (sizeInMB\ *\ 1024\ *\ 1024)\ /\ entrySize;}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ table.resize(numEntries);}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ size\ =\ numEntries;}
\DoxyCodeLine{00037\ \ \ \ \ \}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{class_transposition_table_a1e8ae72c80b51976356a6a7943b05b0a}{clear}}()\ \{}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ std::fill(table.begin(),\ table.end(),\ \doxymbox{\hyperlink{struct_t_t_entry}{TTEntry}}\{\ 0,\ 0,\ 0,\ TT\_EXACT,\ Move()\ \});}
\DoxyCodeLine{00046\ \ \ \ \ \}}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{comment}{//\ Save\ position}}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{class_transposition_table_a1712398fea56846c3a7709efc91cc68a}{store}}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ key,\ \textcolor{keywordtype}{int}\ score,\ \textcolor{keywordtype}{int}\ depth,\ TTFlag\ flag,\ \doxymbox{\hyperlink{struct_move}{Move}}\ bestMove)\ \{}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ index\ =\ key\ \%\ size;}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Always\ preserve\ the\ entry\ with\ the\ greatest\ depth}}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Always\ overwrite\ for\ simplicity}}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \doxymbox{\hyperlink{struct_t_t_entry}{TTEntry}}\&\ entry\ =\ table[index];}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (entry.key\ ==\ key)\ \{}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (depth\ >=\ entry.depth)\ \{}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ entry.score\ =\ score;}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ entry.depth\ =\ depth;}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ entry.flag\ =\ flag;}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ entry.bestMove\ =\ bestMove;}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Always\ overwrite}}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \ \ \ \ entry.key\ =\ key;}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \ entry.score\ =\ score;}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \ entry.depth\ =\ depth;}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ \ \ entry.flag\ =\ flag;}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \ \ entry.bestMove\ =\ bestMove;}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00082\ \ \ \ \ \}}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{comment}{//\ Read\ position}}
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{keywordtype}{bool}\ \doxymbox{\hyperlink{class_transposition_table_a282290f874e3ddc1afb67edcfb1d7b4a}{probe}}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ key,\ \textcolor{keywordtype}{int}\ depth,\ \textcolor{keywordtype}{int}\ alpha,\ \textcolor{keywordtype}{int}\ beta,\ \textcolor{keywordtype}{int}\&\ outScore,\ \doxymbox{\hyperlink{struct_move}{Move}}\&\ outMove)\ \{}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (key\ ==\ 0)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ index\ =\ key\ \%\ size;}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \doxymbox{\hyperlink{struct_t_t_entry}{TTEntry}}\&\ entry\ =\ table[index];}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (entry.key\ ==\ 0)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (entry.key\ ==\ key)\ \{\ \textcolor{comment}{//\ Hit}}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \ \ \ \ outMove\ =\ entry.bestMove;\ \textcolor{comment}{//\ Always\ return\ best\ move}}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (entry.depth\ >=\ depth)\ \{\ \textcolor{comment}{//\ Only\ if\ reached\ depth}}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (entry.flag\ ==\ TT\_EXACT)\ \{}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ outScore\ =\ entry.score;}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (entry.flag\ ==\ TT\_ALPHA\ \&\&\ entry.score\ <=\ alpha)\ \{}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ outScore\ =\ alpha;}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (entry.flag\ ==\ TT\_BETA\ \&\&\ entry.score\ >=\ beta)\ \{}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ outScore\ =\ beta;}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00122\ \ \ \ \ \}}
\DoxyCodeLine{00123\ \};}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \textcolor{comment}{//\ 64\ MB\ Transposition\ Table\ instance}}
\DoxyCodeLine{00126\ \textcolor{keyword}{extern}\ \doxymbox{\hyperlink{class_transposition_table}{TranspositionTable}}\ TT;}

\end{DoxyCode}
